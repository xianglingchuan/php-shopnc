$(document).ready(function(){var e;var t;$('a[nctype="nyroModal"]').nyroModal();var i="<input type='text' name='textfield' id='textfield1' class='type-file-text' /><input type='button' name='button' id='button1' value='' class='type-file-button' />";$(i).insertBefore("#special_image");$("#special_image").change(function(){$("#textfield1").val($("#special_image").val())});var n="<input type='text' name='textfield' id='textfield2' class='type-file-text' /><input type='button' name='button' id='button2' value='' class='type-file-button' />";$(n).insertBefore("#special_background");$("#special_background").change(function(){$("#textfield2").val($("#special_background").val())});$("input[nctype='cms_image']").live("change",function(){var e=getFullPath($(this)[0]);$(this).parent().prev().find(".low_source").attr("src",e);$(this).parent().find('input[class="type-file-text"]').val($(this).val())});$("#picture_image_upload").fileupload({dataType:"json",url:"index.php?act=cms_special&op=special_image_upload",add:function(e,t){$.each(t.files,function(e,t){var i="<li id="+t.name.replace(".","_")+' class="picture">';i+='<div class="size-64x64"><span class="thumb size-64x64"><i></i><img src="'+LOADING_IMAGE+'" alt="" /></span></div>';i+='<p class="handle">';i+="</p>";$("#special_image_list").append(i)});t.submit()},done:function(e,t){result=t.result;var i=$("#"+result.origin_file_name.replace(".","_"));if(result.status=="success"){i.find("img").attr("src",result.file_url);var n=i.find(".handle");var a='<a nctype="btn_show_image_insert_link" image_url="'+result.file_url+'" class="insert-link tooltip" title="以图片链接模式插入专题页">&nbsp;</a>';a+='<a nctype="btn_show_image_insert_hot_point" image_name="'+result.file_name+'" image_url="'+result.file_url+'" class="insert-hotpoint tooltip " title="以热点链接模式插入专题页">&nbsp;</a>';a+='<a nctype="btn_drop_special_image" image_name="'+result.file_name+'" class="delete tooltip " title="删除该图片">&nbsp;</a>';n.html(a);var l='<input name="special_image_all[]" type="hidden" value="'+result.file_name+'" />';n.after(l);i.attr("id","")}else{i.remove();alert(result.error)}}});$("[nctype='btn_drop_special_image']").live("click",function(){var e=$(this).parents("li");var t=$(this).attr("image_name");$.getJSON("index.php?act=cms_special&op=special_image_drop",{image_name:t},function(t){if(t.status=="success"){e.remove()}else{showError(t.error)}})});$("[nctype='btn_show_image_insert_link']").live("click",function(){$("#_dialog_image_insert_link").find("img").attr("src",$(this).attr("image_url"));html_form("dialog_image_insert_link","图片链接",$("#_dialog_image_insert_link").html(),640)});$("[nctype='btn_image_insert_link']").live("click",function(){var e=$("#special_content").val();var t=$(this).parents("table");var i=t.find("[nctype='_image_insert_link']").val();e+="<div class='special-content-link'>";if(i!=""){e+="<a href="+i+" target='_blank'>"}e+=$("<div />").append(t.find("img").clone()).html();if(i!=""){e+="</a>"}e+="</div>";$("#special_content").val(e);a();DialogManager.close("dialog_image_insert_link")});$("[nctype='btn_show_image_insert_hot_point']").live("click",function(){$("#_dialog_image_insert_hot_point").find("img").attr("src",$(this).attr("image_url"));e=html_form("dialog_image_insert_hot_point","图片热点",$("#_dialog_image_insert_hot_point").html(),1040);var i=0;var n=$("#fwin_dialog_image_insert_hot_point");var a=$(this).attr("image_name").replace(".","");t=n.find("[nctype='img_hot_point']");var l=n.find("[nctype='x1']");var c=n.find("[nctype='y1']");var s=n.find("[nctype='x2']");var o=n.find("[nctype='y2']");var r=n.find("[nctype='w']");var _=n.find("[nctype='h']");var p=n.find("[nctype='url']");t.imgAreaSelect({handles:true,fadeSpeed:200,onSelectChange:preview});t.attr("usemap","#"+a);t.after('<map id="'+a+'" name="'+a+'"></map>');$("[nctype='delete_hot_point']").live("click",function(){var e=$(this).attr("name");$("#"+e).remove();$("."+e).remove()});$("[nctype='select_hot_point']").live("click",function(){var e=$(this).attr("name");var i=e.split(",");var n=t.imgAreaSelect({instance:true});n.setSelection(i[0],i[1],i[2],i[3],true);n.setOptions({show:true});n.update()});n.find("[nctype='btn_hot_point_commit']").click(function(){i++;var e=a+i;var d=l.val()+","+c.val()+","+s.val()+","+o.val()+",";t.parent().find("map").append("<area id="+e+' shape="rect" coords="'+d+'" href="'+p.val()+'" target="_blank" />');n.find("[nctype='list']").append('<li class="'+e+'"><i></i>热点区域'+i+"<span>("+p.val()+')</span><a nctype="select_hot_point" name="'+d+'" href="###" class="btn-select-hot-point">选中</a><a nctype="delete_hot_point" class="btn-delete-hot-point" name="'+e+'" href="###">删除</a></li>');t.after("<div class="+e+' style="width:'+r.val()+"px;height:"+_.val()+"px;position:absolute;left:"+l.val()+"px;top:"+c.val()+'px;border:1px solid #cccccc;">'+i+"</div>");p.val("");var v=t.imgAreaSelect({instance:true});v.cancelSelection()});$(".dialog_close_button").unbind().bind("click",function(){var e=t.imgAreaSelect({instance:true});e.cancelSelection();DialogManager.close("dialog_image_insert_hot_point")})});$("[nctype='btn_image_insert_hot_point']").live("click",function(){var e=$("#special_content").val();var i=$(this).parents("table").find(".special-hot-point").clone();i.find("div").remove();i=$("<div />").append(i).html();e+=i;$("#special_content").val(e);a();var n=t.imgAreaSelect({instance:true});n.cancelSelection();DialogManager.close("dialog_image_insert_hot_point")});$("[nctype='btn_drop_special_image']").click(function(){$(this).parents(".picture").remove()});$("#btn_show_special_insert_goods").click(function(){html_form("dialog_special_insert_goods","插入商品",$("#_dialog_special_insert_goods").html(),640)});$("[nctype='btn_special_goods']").live("click",function(){var e=$(this).parents("table").find("[nctype='_special_goods_list']");var t=$(this).parents("table").find("[nctype='_input_goods_link']");var i=t.val();t.val("");if(i!=""){var n=encodeURIComponent(i);$.getJSON("index.php?act=cms_special&op=goods_info_by_url",{url:n},function(t){if(t.result=="true"){var i='<li nctype="btn_goods_select"><dl>';i+='<dt class="name"><a href="'+t.url+'" target="_blank">'+t.title+"</a></dt>";i+='<dd class="image"><a href="'+t.url+'" target="_blank"><img title="'+t.title+'" src="'+t.image+'" /></a></dd>';i+='<dd class="price">价格：<em>'+t.price+"</em></dd>";i+='<dd class="taobao-item-delete" nctype="btn_special_goods_delete" title="删除添加的商品">&nbsp;</dd>';i+="</dl></li>";$(e).append(i)}else{alert(t.message)}})}});$("[nctype='btn_special_goods_delete']").live("click",function(){$(this).parent().parent().remove()});$("[nctype='btn_special_insert_goods']").live("click",function(){var e=$("#special_content").val();e+="<div class='special-content-goods-list'>";var t=$("<div />").append($(this).parents("table").find("[nctype='_special_goods_list']").clone());t.find("i").remove();t.find("[nctype='btn_special_goods_delete']").remove();e+=t.html();e+="</div>";$("#special_content").val(e);a();DialogManager.close("dialog_special_insert_goods")});$("#btn_content_edit").click(function(){$(this).attr("class","tab-btn actived");$("#btn_content_view").attr("class","tab-btn");$("#div_content_edit").show();$("#div_content_view").hide()});$("#btn_content_view").click(function(){$(this).attr("class","tab-btn actived");$("#btn_content_edit").attr("class","tab-btn");$("#div_content_edit").hide();$("#div_content_view").show()});$("#special_content").change(function(){a()});function a(){$("#div_content_view").html($("#special_content").val())}a()});function preview(e,t){if(!t.width||!t.height)return;var i=100/t.width;var n=100/t.height;$("#preview img").css({width:Math.round(i*300),height:Math.round(n*300),marginLeft:-Math.round(i*t.x1),marginTop:-Math.round(n*t.y1)});var a=$("#fwin_dialog_image_insert_hot_point");a.find("[nctype='x1']").val(t.x1);a.find("[nctype='y1']").val(t.y1);a.find("[nctype='x2']").val(t.x2);a.find("[nctype='y2']").val(t.y2);a.find("[nctype='w']").val(t.width);a.find("[nctype='h']").val(t.height)}